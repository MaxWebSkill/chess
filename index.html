<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>КЗ ДЮСШ "Дебют"</title>
    <style>
        /* Стилі з найпершої версії для збереження дизайну */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f4f4;
            color: #333;
        }
        .header {
            background-color: #34495e;
            color: white;
            padding: 15px 0;
            text-align: center;
        }
        .container {
            width: 80%;
            margin: 20px auto;
            background-color: white;
            padding: 20px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
        }
        .section {
            margin-bottom: 30px;
            padding: 15px;
            border-bottom: 1px solid #ddd;
        }
        .section h2 {
            color: #e74c3c;
            border-bottom: 2px solid #34495e;
            padding-bottom: 5px;
            margin-bottom: 15px;
        }
        .item {
            border: 1px solid #ccc;
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 4px;
        }
        .item h3 {
            margin-top: 0;
            color: #2c3e50;
        }
        .item p {
            margin: 5px 0;
        }
        .item img {
            max-width: 100%;
            height: auto;
            border-radius: 4px;
            margin-top: 10px;
        }
        .tournament-link {
            display: block;
            margin-top: 10px;
            color: #3498db;
            font-weight: bold;
        }
        .list-group {
            max-height: 400px;
            overflow-y: auto;
            padding-right: 15px;
        }
        .loading, .error {
            text-align: center;
            padding: 20px;
            color: #e74c3c;
        }
        .member-list {
            list-style: none;
            padding: 0;
        }
        .member-list li {
            background: #ecf0f1;
            margin-bottom: 5px;
            padding: 8px 12px;
            border-radius: 4px;
            display: flex;
            justify-content: space-between;
        }
        .member-list span:first-child {
            font-weight: bold;
        }
    </style>
</head>
<body>

    <div class="header">
        <h1>КЗ ДЮСШ "Дебют"</h1>
        <p>Група Волошинського Любомира</p>
    </div>

    <div class="container">
        
        <div class="section" id="members-section">
            <h2>Склад гуртка та рейтинги</h2>
            <div id="membersList" class="list-group">
                <div class="loading">Завантаження складу...</div>
            </div>
        </div>

        <div class="section" id="tournaments-section">
            <h2>Поточний турнір та результати</h2>
            <div id="currentTournament">
                <p><strong>Поточний турнір:</strong> <span id="currentTitle">...</span></p>
                <a href="#" target="_blank" id="currentLink" class="tournament-link" style="display: none;">Переглянути результати онлайн</a>
            </div>
            
            <hr style="margin: 20px 0;">
            
            <h3>Результати минулого тижня</h3>
            <p id="lastWeekResults">... завантаження ...</p>
        </div>

        <div class="section" id="news-section">
            <h2>Останні Новини</h2>
            <div id="newsList" class="list-group">
                <div class="loading">Завантаження новин...</div>
            </div>
        </div>

        <div class="section" id="homework-section">
            <h2>Домашнє Завдання</h2>
            <div id="homeworkList" class="list-group">
                <div class="loading">Завантаження завдань...</div>
            </div>
        </div>

        <div class="section" id="events-section">
            <h2>Найближчі Події</h2>
            <div id="eventsList" class="list-group">
                <div class="loading">Завантаження подій...</div>
            </div>
        </div>

    </div>

    <script>
        // ✅ ВАША АКТУАЛЬНА АДРЕСА API НА RENDER
        const API_URL = 'https://chess-2pyz.onrender.com/api'; 

        // --- Допоміжна функція для завантаження даних ---
        async function loadData(endpoint, listId, renderFunction) {
            const container = document.getElementById(listId);
            container.innerHTML = '<div class="loading">Завантаження...</div>';

            try {
                const response = await fetch(`${API_URL}${endpoint}`);
                if (!response.ok) {
                    throw new Error(`Помилка: ${response.status}`);
                }
                const data = await response.json();
                renderFunction(data, container);
            } catch (error) {
                container.innerHTML = `<div class="error">Помилка завантаження даних: ${error.message}</div>`;
                console.error(`Error loading ${endpoint}:`, error);
            }
        }

        // --- Функції відображення даних ---

        // 1. Новини
        function renderNews(data, container) {
            if (data.length === 0) {
                container.innerHTML = '<p>Наразі новин немає.</p>';
                return;
            }
            container.innerHTML = data.map(post => `
                <div class="item">
                    <h3>${post.title} <small style="color: #999; font-size: 0.8em;">(${new Date(post.date).toLocaleDateString('uk-UA')})</small></h3>
                    <p>${post.description.replace(/\n/g, '<br>')}</p>
                    ${post.imageUrl ? `<img src="${post.imageUrl}" alt="${post.title}" loading="lazy">` : ''}
                </div>
            `).join('');
        }

        // 2. Домашнє Завдання
        function renderHomework(data, container) {
            if (data.length === 0) {
                container.innerHTML = '<p>Наразі домашнього завдання немає.</p>';
                return;
            }
            container.innerHTML = data.map(hw => `
                <div class="item">
                    <h3>${hw.title} <small style="color: #999; font-size: 0.8em;">(${new Date(hw.date).toLocaleDateString('uk-UA')})</small></h3>
                    ${hw.imageUrl ? `<img src="${hw.imageUrl}" alt="${hw.title}" loading="lazy">` : ''}
                </div>
            `).join('');
        }

        // 3. Події
        function renderEvents(data, container) {
            if (data.length === 0) {
                container.innerHTML = '<p>Найближчих подій немає.</p>';
                return;
            }
            container.innerHTML = data.map(event => `
                <div class="item">
                    <h3>${event.title}</h3>
                    <p><strong>Дата:</strong> ${event.date}</p>
                    <p><strong>Місце:</strong> ${event.location}</p>
                    <p>${event.description}</p>
                </div>
            `).join('');
        }

        // 4. Турніри (Оновлення секції, а не списку)
        async function loadTournaments() {
            try {
                const response = await fetch(`${API_URL}/tournaments`);
                if (!response.ok) throw new Error('Помилка завантаження турнірів');
                const data = await response.json();

                // Поточний турнір
                const titleEl = document.getElementById('currentTitle');
                const linkEl = document.getElementById('currentLink');
                
                titleEl.textContent = data.current?.title || 'Інформація відсутня';
                
                if (data.current?.link) {
                    linkEl.href = data.current.link;
                    linkEl.style.display = 'block';
                } else {
                    linkEl.style.display = 'none';
                }

                // Результати минулого тижня
                document.getElementById('lastWeekResults').textContent = data.lastWeek || 'Дані за минулий тиждень відсутні.';

            } catch (error) {
                document.getElementById('tournaments-section').innerHTML = `<div class="error">Не вдалося завантажити дані про турніри.</div>`;
            }
        }

        // 5. Склад гуртка (Google Sheets)
        function renderMembers(data, container) {
            if (data.length === 0) {
                container.innerHTML = '<p>Список учасників не завантажено або порожній. Перевірте налаштування Google Sheets в адмін-панелі.</p>';
                return;
            }
            container.innerHTML = `<ul class="member-list">` + data.map(member => `
                <li>
                    <span>${member.name}</span>
                    <span>Рейтинг: ${member.rating || 'N/A'}</span>
                </li>
            `).join('') + `</ul>`;
        }


        // --- Ініціалізація: Завантаження всіх даних ---
        document.addEventListener('DOMContentLoaded', () => {
            loadTournaments();
            loadData('/news', 'newsList', renderNews);
            loadData('/homework', 'homeworkList', renderHomework);
            loadData('/events', 'eventsList', renderEvents);
            loadData('/members', 'membersList', renderMembers); // Завантаження учасників
        });
    </script>
</body>
</html>